window.onerror=function(a,b,c){$.post("/api/javascript/log/",{url:b,msg:a,line:c})};var hash=window.location.hash,handlers=[],opt={};
$.extend({anchorHandler:{apply:function(){$.map(handlers,function(a){var b=hash.match(a.r)&&hash.match(a.r)[0]||!1;b&&a.cb.apply($("a[href*="+b+"]").get(0),[a.r,hash||""])});return $.anchorHandler},add:function(a,b,c){var d=$.extend({handleClick:!0,preserveHash:!0},c);d.handleClick&&$("a[href*=#]").each(function(c,f){f.href.match(a)&&$(f).bind("click.anchorHandler",function(){d.preserveHash&&(window.location.hash=f.hash);return b.apply(this,[a,f.href])})});handlers.push({r:a,cb:b});$($.anchorHandler.apply);
return $.anchorHandler}}});
(function(){function a(a){return(10>a?"0":"")+a}function b(a){var b=++K+"";return a?a+b:b}function c(c,f){function C(a,b){var c=s.offset(),d=/^touch/.test(a.type),e=c.left+w,h=c.top+w,k=(d?a.originalEvent.touches[0]:a).pageX-e,E=(d?a.originalEvent.touches[0]:a).pageY-h,c=Math.sqrt(k*k+E*E),C=!1;if(!b||!(c<y-A||c>y+A)){a.preventDefault();var u=setTimeout(function(){m.addClass("clockpicker-moving")},200);n&&s.append(z.canvas);z.setHand(k,E,!b,!0);g.off(l).on(l,function(a){a.preventDefault();var b=/^touch/.test(a.type),
c=(b?a.originalEvent.touches[0]:a).pageX-e;a=(b?a.originalEvent.touches[0]:a).pageY-h;if(C||!(c===k&&a===E))C=!0,z.setHand(c,a,!1,!0)});g.off(p).on(p,function(a){g.off(p);a.preventDefault();var c=/^touch/.test(a.type),d=(c?a.originalEvent.changedTouches[0]:a).pageX-e;a=(c?a.originalEvent.changedTouches[0]:a).pageY-h;(b||C)&&(d===k&&a===E)&&z.setHand(d,a);"hours"===z.currentView?z.toggleView("minutes",G/2):f.autoclose&&(z.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){z.done()},
G/2));s.prepend(H);clearTimeout(u);m.removeClass("clockpicker-moving");g.off(l)})}}var u=e(L),s=u.find(".clockpicker-plate"),x=u.find(".clockpicker-hours"),B=u.find(".clockpicker-minutes"),r=u.find(".clockpicker-am-pm-block"),k="INPUT"===c.prop("tagName"),q=k?c:c.find("input"),t=c.find(".input-group-addon"),z=this;this.id=b("cp");this.element=c;this.options=f;this.isShown=this.isAppended=!1;this.currentView="hours";this.isInput=k;this.input=q;this.addon=t;this.popover=u;this.plate=s;this.hoursView=
x;this.minutesView=B;this.amPmBlock=r;this.spanHours=u.find(".clockpicker-span-hours");this.spanMinutes=u.find(".clockpicker-span-minutes");this.spanAmPm=u.find(".clockpicker-span-am-pm");this.amOrPm="PM";f.twelvehour&&(e('<div class="clockpicker-am-pm-block"><button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">AM</button><button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">PM</button></div>'),e('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",
function(){z.amOrPm="AM";e(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock),e('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){z.amOrPm="PM";e(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock));f.autoclose||e('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+f.donetext+"</button>").click(e.proxy(this.done,this)).appendTo(u);if(("top"===f.placement||
"bottom"===f.placement)&&("top"===f.align||"bottom"===f.align))f.align="left";if(("left"===f.placement||"right"===f.placement)&&("left"===f.align||"right"===f.align))f.align="top";u.addClass(f.placement);u.addClass("clockpicker-align-"+f.align);this.spanHours.click(e.proxy(this.toggleView,this,"hours"));this.spanMinutes.click(e.proxy(this.toggleView,this,"minutes"));q.on("focus.clockpicker click.clockpicker",e.proxy(this.show,this));t.on("click.clockpicker",e.proxy(this.toggle,this));var r=e('<div class="clockpicker-tick"></div>'),
D;if(f.twelvehour)for(k=1;13>k;k+=1)q=r.clone(),t=k/6*Math.PI,D=y,q.css("font-size","120%"),q.css({left:w+Math.sin(t)*D-A,top:w-Math.cos(t)*D-A}),q.html(0===k?"00":k),x.append(q),q.on(v,C);else for(k=0;24>k;k+=1){var q=r.clone(),t=k/6*Math.PI,I=0<k&&13>k;D=I?F:y;q.css({left:w+Math.sin(t)*D-A,top:w-Math.cos(t)*D-A});I&&q.css("font-size","120%");q.html(0===k?"00":k);x.append(q);q.on(v,C)}for(k=0;60>k;k+=5)q=r.clone(),t=k/30*Math.PI,q.css({left:w+Math.sin(t)*y-A,top:w-Math.cos(t)*y-A}),q.css("font-size",
"120%"),q.html(a(k)),B.append(q),q.on(v,C);s.on(v,function(a){0===e(a.target).closest(".clockpicker-tick").length&&C(a,!0)});if(n){var H=u.find(".clockpicker-canvas"),u=document.createElementNS(h,"svg");u.setAttribute("class","clockpicker-svg");u.setAttribute("width",J);u.setAttribute("height",J);x=document.createElementNS(h,"g");x.setAttribute("transform","translate("+w+","+w+")");B=document.createElementNS(h,"circle");B.setAttribute("class","clockpicker-canvas-bearing");B.setAttribute("cx",0);B.setAttribute("cy",
0);B.setAttribute("r",2);r=document.createElementNS(h,"line");r.setAttribute("x1",0);r.setAttribute("y1",0);k=document.createElementNS(h,"circle");k.setAttribute("class","clockpicker-canvas-bg");k.setAttribute("r",A);q=document.createElementNS(h,"circle");q.setAttribute("class","clockpicker-canvas-fg");q.setAttribute("r",3.5);x.appendChild(r);x.appendChild(k);x.appendChild(q);x.appendChild(B);u.appendChild(x);H.append(u);this.hand=r;this.bg=k;this.fg=q;this.bearing=B;this.g=x;this.canvas=H}d(this.options.init)}
function d(a){a&&"function"===typeof a&&a()}var e=window.jQuery,f=e(window),g=e(document),m,h="http://www.w3.org/2000/svg",n="SVGAngle"in window&&function(){var a,b=document.createElement("div");b.innerHTML="<svg/>";a=(b.firstChild&&b.firstChild.namespaceURI)==h;b.innerHTML="";return a}(),s=function(){var a=document.createElement("div").style;return"transition"in a||"WebkitTransition"in a||"MozTransition"in a||"msTransition"in a||"OTransition"in a}(),t="ontouchstart"in window,v="mousedown"+(t?" touchstart":
""),l="mousemove.clockpicker"+(t?" touchmove.clockpicker":""),p="mouseup.clockpicker"+(t?" touchend.clockpicker":""),r=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,K=0,w=100,y=80,F=54,A=13,J=2*w,G=s?350:1,L='<div class="popover clockpicker-popover"><div class="arrow"></div><div class="popover-title"><span class="clockpicker-span-hours text-primary"></span> : <span class="clockpicker-span-minutes"></span><span class="clockpicker-span-am-pm"></span></div><div class="popover-content"><div class="clockpicker-plate"><div class="clockpicker-canvas"></div><div class="clockpicker-dial clockpicker-hours"></div><div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div></div><span class="clockpicker-am-pm-block"></span></div></div>';
c.DEFAULTS={"default":"",fromnow:0,placement:"bottom",align:"left",donetext:"\u5b8c\u6210",autoclose:!1,twelvehour:!1,vibrate:!0};c.prototype.toggle=function(){this[this.isShown?"hide":"show"]()};c.prototype.locate=function(){var a=this.element,b=this.popover,c=a.offset(),d=a.outerWidth(),a=a.outerHeight(),e=this.options.placement,f=this.options.align,g={};b.show();switch(e){case "bottom":g.top=c.top+a;break;case "right":g.left=c.left+d;break;case "top":g.top=c.top-b.outerHeight();break;case "left":g.left=
c.left-b.outerWidth()}switch(f){case "left":g.left=c.left;break;case "right":g.left=c.left+d-b.outerWidth();break;case "top":g.top=c.top;break;case "bottom":g.top=c.top+a-b.outerHeight()}b.css(g)};c.prototype.show=function(b){if(!this.isShown){d(this.options.beforeShow);var c=this;this.isAppended||(m=e(document.body).append(this.popover),f.on("resize.clockpicker"+this.id,function(){c.isShown&&c.locate()}),this.isAppended=!0);b=((this.input.prop("value")||this.options["default"]||"")+"").split(":");
"now"===b[0]&&(b=new Date(+new Date+this.options.fromnow),b=[b.getHours(),b.getMinutes()]);this.hours=+b[0]||0;this.minutes=+b[1]||0;this.spanHours.html(a(this.hours));this.spanMinutes.html(a(this.minutes));this.toggleView("hours");this.locate();this.isShown=!0;g.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(a){a=e(a.target);0===a.closest(c.popover).length&&(0===a.closest(c.addon).length&&0===a.closest(c.input).length)&&c.hide()});g.on("keyup.clockpicker."+this.id,function(a){27===
a.keyCode&&c.hide()});d(this.options.afterShow)}};c.prototype.hide=function(){d(this.options.beforeHide);this.isShown=!1;g.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id);g.off("keyup.clockpicker."+this.id);this.popover.hide();d(this.options.afterHide)};c.prototype.toggleView=function(a,b){var c=!1;"minutes"===a&&"visible"===e(this.hoursView).css("visibility")&&(d(this.options.beforeHourSelect),c=!0);var f="hours"===a,g=f?this.hoursView:this.minutesView,h=f?this.minutesView:this.hoursView;
this.currentView=a;this.spanHours.toggleClass("text-primary",f);this.spanMinutes.toggleClass("text-primary",!f);h.addClass("clockpicker-dial-out");g.css("visibility","visible").removeClass("clockpicker-dial-out");this.resetClock(b);clearTimeout(this.toggleViewTimer);this.toggleViewTimer=setTimeout(function(){h.css("visibility","hidden")},G);c&&d(this.options.afterHourSelect)};c.prototype.resetClock=function(a){var b=this.currentView,c=this[b],d="hours"===b,b=c*(Math.PI/(d?6:30)),c=d&&0<c&&13>c?F:
y,e=Math.sin(b)*c,f=-Math.cos(b)*c,g=this;n&&a?(g.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){g.canvas.removeClass("clockpicker-canvas-out");g.setHand(e,f)},a)):this.setHand(e,f)};c.prototype.setHand=function(b,c,d,f){var g=Math.atan2(b,-c),h="hours"===this.currentView,l=Math.PI/(h||d?6:30);c=Math.sqrt(b*b+c*c);b=this.options;var p=h&&c<(y+F)/2;c=p?F:y;var k;b.twelvehour&&(c=y);0>g&&(g=2*Math.PI+g);k=Math.round(g/l);g=k*l;b.twelvehour?h?0===k&&(k=12):(d&&(k*=5),60===k&&(k=0)):
h?(12===k&&(k=0),k=p?0===k?12:k:0===k?0:k+12):(d&&(k*=5),60===k&&(k=0));this[this.currentView]!==k&&(r&&this.options.vibrate&&!this.vibrateTimer)&&(navigator[r](10),this.vibrateTimer=setTimeout(e.proxy(function(){this.vibrateTimer=null},this),100));this[this.currentView]=k;this[h?"spanHours":"spanMinutes"].html(a(k));n?(f||!h&&k%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,
this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg")),d=Math.sin(g)*c,g=-Math.cos(g)*c,this.hand.setAttribute("x2",d),this.hand.setAttribute("y2",g),this.bg.setAttribute("cx",d),this.bg.setAttribute("cy",g),this.fg.setAttribute("cx",d),this.fg.setAttribute("cy",g)):this[h?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var a=e(this);a.toggleClass("active",k===+a.html())})};c.prototype.done=function(){d(this.options.beforeDone);this.hide();
var b=this.input.prop("value"),c=a(this.hours)+":"+a(this.minutes);this.options.twelvehour&&(c+=this.amOrPm);this.input.prop("value",c);c!==b&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change"));this.options.autoclose&&this.input.trigger("blur");d(this.options.afterDone)};c.prototype.remove=function(){this.element.removeData("clockpicker");this.input.off("focus.clockpicker click.clockpicker");this.addon.off("click.clockpicker");this.isShown&&this.hide();this.isAppended&&
(f.off("resize.clockpicker"+this.id),this.popover.remove())};e.fn.clockpicker=function(a){var b=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=e(this),f=d.data("clockpicker");f?"function"===typeof f[a]&&f[a].apply(f,b):(f=e.extend({},c.DEFAULTS,d.data(),"object"==typeof a&&a),d.data("clockpicker",new c(d,f)))})}})();
function remotePostCall(a,b,c){$.post("%PATH%"+a,c,function(d,e){"success"==e?(result=jQuery.parseJSON(d),null!=result&&void 0!=result.success?handlePostSuccess(a,result.message,c,e):alert(b)):alert(b)},"text")}function loadURL(a,b,c){$("#"+a).load(b,null,c)}var vc=vc||{};vc.switchVisibility=function(a){element=$("#"+a);null!=element&&(element.is(":visible")?element.hide():element.show())};
function printEditRegionCombo(){regionElement=$("#region");if(0!=regionElement.length){regionElement.empty();var a=$("#country").val(),a=regionArray[a];if(void 0!=a){regionElement.append('<option value="">'+noStatementOption+"</option>");for(var b=0;b<a.length;b++)a[b]==defaultRegion?regionElement.append('<option value="'+a[b]+'" selected="selected">'+a[b]+"</option>"):regionElement.append('<option value="'+a[b]+'">'+a[b]+"</option>")}}}
function printSearchRegionCombo(){for(var a=$("input[name='country[]']"),b=[],c=0;c<a.length;c++)regionGroup=$("#regiongroup"+a[c].value),regionGroup.length&&(a[c].checked&&b.push(a[c].value),regionGroup.hide());for(c=0;c<b.length;c++)$("#regiongroup"+b[c]).show()}function hasValue(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return!0;return!1}function invertCheckboxSelection(a){elements=document.getElementsByName(a);for(i=0;i<elements.length;i++)elements[i].checked=!elements[i].checked}
function updateFileUploads(){var a=0;for(i=0;i<existingpics.length;i++)document.getElementById("Pic"+existingpics[i]+"Delete").checked||a++;for(newPic=1;8>=newPic;newPic++)newPic<=8-a?$("#newPic"+newPic+"Row").show():($("#newPic"+newPic+"Row").hide(),document.getElementById("newPic"+newPic).value="")}function updateFieldCount(a,b){textElement=document.getElementById(a);labelElement=document.getElementById(a+"count");text=textElement.value;labelElement.innerHTML=text.length+" / "+b}
if(!document.cookie||document.cookie.indexOf("TZoff"))document.cookie="TZoff="+(new Date).getTimezoneOffset()+";Path=/;"+document.cookie;var visiblePopups=[];
function switchPopup(a,b){popup=document.getElementById(a);null==visiblePopups[a]?(visiblePopups[a]="true",popup.innerHTML='<div class="jLoading"></div>',popup.className="popup-active",loadURL(a,"%PATH%"+b,!1)):"false"==visiblePopups[a]?(visiblePopups[a]="true",popup.className="popup-active"):(visiblePopups[a]="false",popup.className="popup")}var visibleSidebarBlocks=[];
function switchSidebarBlock(a,b){var c=document.getElementById(a),d=document.getElementById(a+"-header");null==visibleSidebarBlocks[a]?(visibleSidebarBlocks[a]="true",c.innerHTML='<div class="jLoading"></div>',d.className="openslide",$(c).show(),loadURL(a,"%PATH%"+b,!1)):"false"==visibleSidebarBlocks[a]?(visibleSidebarBlocks[a]="true",d.className="openslide",$(c).show()):(visibleSidebarBlocks[a]="false",d.className="hiddenslide",$(c).hide())}
function loadPollForm(a){loadURL("poll"+a,"%PATH%poll/view/"+a+"/form",!1);return!1}function loadPollResult(a){loadURL("poll"+a,"%PATH%poll/view/"+a+"/result",!1);return!1}function addActivity(){var a=$("#activitymessage"),b=a.val(),a=a.closest("form");500>=b.length?($(".jLoading",a).show(),$(".save",a).hide(),remotePostCall("activity/add/","%GETTEXT('activity.remotecallfailed')%",{message:b})):alert("%GETTEXT('activity.toolongmessage')%")}
function deleteActivity(a){confirm("%GETTEXT('activity.delete.confirm')%")&&remotePostCall("activity/delete/","%GETTEXT('activity.remotecallfailed')%",{id:a})}var visitorDisplayCount=24;
function showVisitors(){tabContent=document.getElementById("visitors");tabContent.innerHTML='<div class="jLoading"></div>';loadURL("visitors","%PATH%mysite/visitors/"+visitorDisplayCount,function(a,b,c){"success"!=b?document.getElementById("visitors").innerHTML="%GETTEXT('mysite.visitors.loadingfailed')%":visitorDisplayCount="%LAST_VISITOR_XS%"==visitorDisplayCount?"%LAST_VISITOR_XL%":"%LAST_VISITOR_XS%"})}
function showSearchResult(a,b){0<a.length&&0<b.length&&(contentID=a.shift(),url=b.shift(),loadURL("search"+contentID+"Content",url,function(c,d,e){"success"!=d&&(document.getElementById("search"+contentID+"Content").innerHTML="%GETTEXT('mysite.savedsearchs.loadingfailed')%");showSearchResult(a,b)}))}function deleteSavedSearch(a){confirm("%GETTEXT('mysite.savedsearch.deletesearch.confirm')%")&&remotePostCall("user/result/delete/","%GETTEXT('friendinbox.remotecallfailed')%",{searchid:a})}
function blockUser(a){confirm("%GETTEXT('profile.blockprofile.confirm')%")&&remotePostCall("block/add/","%GETTEXT('profile.remotecallfailed')%",{profileid:a})}slidesVisibility=[];hobbiesLoaded=!1;function setSlideVisible(a){isSlideVisible(a)?collapseSlide(a):expandSlide(a)}function isSlideVisible(a){arrayid="."+a;return"true"==slidesVisibility[arrayid]||null==slidesVisibility[arrayid]?!0:!1}
function collapseSlide(a){arrayid="."+a;headerElement=document.getElementById("slide-header-"+a);contentElement=document.getElementById("slide-content-"+a);null!=headerElement&&null!=contentElement&&(headerElement.className="hiddenslide",$(contentElement).hide(),slidesVisibility[arrayid]="false")}
function expandSlide(a){arrayid="."+a;headerElement=document.getElementById("slide-header-"+a);contentElement=document.getElementById("slide-content-"+a);null!=headerElement&&null!=contentElement&&(headerElement.className="openslide",$(contentElement).show(),slidesVisibility[arrayid]="true")}function selectAll(a){allelement=document.getElementById(a+".all").checked;elements=document.getElementsByName(a+"[]");for(i=0;i<elements.length;i++)elements[i].checked=!1}
function deselectAll(a){document.getElementById(a+".all").checked=!1}function handlePostSuccess(a,b,c,d){"success"==d&&"user/result/delete"==a&&$("#search"+c.searchid).hide();""!=b.trim()&&alert(b)}vc=vc||{};vc.date={parseTime:function(a){a=a.split(":");return 2==a.length?3600*a[0]+60*a[1]:0}};
vc.localStorage={add:function(a,b){if(localStorage){var c=localStorage.getItem(a),c=null===c||""===c?[]:c.split(",");c.push(b);localStorage.setItem(a,c.toString())}},remove:function(a,b){if(localStorage){var c=localStorage.getItem(a);if(null!=c){for(var c=c.split(","),d=c.length-1;0<=d;d--)c[d]===b&&c.splice(d,1);localStorage.setItem(a,c.toString())}}}};
vc.friends={add:function(a){a.preventDefault();var b=$(a.target).closest("a");confirm("%GETTEXT('profile.friend.confirm')%")&&$.post("%PATH%friend/add/",{profileid:b.data("userId")},function(a,d,e){!0==a.success?(b.removeClass("addFriend"),b.addClass("cancelFriend"),$("span",b).html("%GETTEXT('profile.friend.cancel')%"),b.prop("title","%GETTEXT('profile.friend.cancel')% %GETTEXT('profile.friend.title')%")):""!==a.message?alert(a.message):alert("%GETTEXT('profile.remotecallfailed')%")}).fail(function(){alert("%GETTEXT('profile.remotecallfailed')%")})},
cancel:function(a){a.preventDefault();var b=$(a.target).closest("a");$.post("%PATH%friend/delete/",{profileid:b.data("userId")},function(a,d,e){!0==a.success?(b.removeClass("cancelFriend"),b.addClass("addFriend"),$("span",b).html("%GETTEXT('profile.addfriend')%"),b.prop("title","%GETTEXT('profile.addfriend')% %GETTEXT('profile.friend.title')%"),$("#friendProfilebox"+b.data("userId")).remove()):""!==a.message?alert(a.message):alert("%GETTEXT('profile.remotecallfailed')%")}).fail(function(){alert("%GETTEXT('profile.remotecallfailed')%")})},
confirm:function(a){a.preventDefault();var b=$(a.target).closest("a");$.post("%PATH%friend/accept/",{profileid:b.data("userId")},function(a,d,e){!0==a.success?(b.removeClass("confirmFriend"),b.addClass("deleteFriend"),$("span",b).html("%GETTEXT('mysite.friends.deletefriend')%"),b.prop("title","%GETTEXT('profile.friends.deletefriend')% %GETTEXT('profile.friend.title')%"),$(".denyFriend",b.parent()).remove(),$("#friendProfilebox"+b.data("userId")).remove(),0===$("#friendInbox li").length&&$("#friendInbox li").hide(),
vc.ui.updateAccountStatus()):""!==a.message?alert(a.message):alert("%GETTEXT('profile.remotecallfailed')%")}).fail(function(){alert("%GETTEXT('profile.remotecallfailed')%")})},deny:function(a){a.preventDefault();var b=$(a.target).closest("a");$.post("%PATH%friend/deny/",{profileid:b.data("userId")},function(a,d,e){!0==a.success?(b.removeClass("denyFriend"),b.addClass("addFriend"),$("span",b).html("%GETTEXT('profile.addfriend')%"),b.prop("title","%GETTEXT('profile.addfriend')% %GETTEXT('profile.friend.title')%"),
$(".confirmFriend",b.parent()).remove(),$("#friendProfilebox"+b.data("userId")).remove(),0===$("#friendInbox li").length&&$("#friendInbox li").hide(),vc.ui.updateAccountStatus()):""!==a.message?alert(a.message):alert("%GETTEXT('profile.remotecallfailed')%")}).fail(function(){alert("%GETTEXT('profile.remotecallfailed')%")})},showOnChange:function(a){text=document.getElementById(a+"comment").value;text==comments[a]?$("#"+a+"save").hide():$("#"+a+"save").show()},remove:function(a){a.preventDefault();
var b=$(a.target).closest("a");confirm("%GETTEXT('mysite.friends.deletefriend.confirm')%")&&$.post("%PATH%friend/delete/",{profileid:b.data("userId")},function(a,d,e){!0==a.success?(b.removeClass("deleteFriend"),b.addClass("addFriend"),$("span",b).html("%GETTEXT('profile.addfriend')%"),b.prop("title","%GETTEXT('profile.addfriend')% %GETTEXT('profile.friend.title')%"),$("#friendProfilebox"+b.data("userId")).remove()):""!==a.message?alert(a.message):alert("%GETTEXT('profile.remotecallfailed')%")}).fail(function(){alert("%GETTEXT('profile.remotecallfailed')%")})}};
vc.favorites={add:function(a){a.preventDefault();var b=$(a.target).closest("a");$.post("%PATH%favorite/add/",{profileid:b.data("userId")},function(a,d,e){!0==a.success?(b.removeClass("addFavorite"),b.addClass("deleteFavorite"),b.attr("title")&&b.attr("title","%GETTEXT('mysite.friends.deletefavorite')%"),$("span",b).html("%GETTEXT('mysite.friends.deletefavorite')%")):""!==a.message?alert(a.message):alert("%GETTEXT('profile.remotecallfailed')%")}).fail(function(){alert("%GETTEXT('profile.remotecallfailed')%")})},
remove:function(a){a.preventDefault();var b=$(a.target).closest("a");confirm("%GETTEXT('mysite.friends.deletefavorite.confirm')%")&&$.post("%PATH%favorite/delete/",{profileid:b.data("userId")},function(a,d,e){!0==a.success?(b.removeClass("deleteFavorite"),b.addClass("addFavorite"),b.attr("title")&&b.attr("title","%GETTEXT('profile.addfavorite')%"),$("span",b).html("%GETTEXT('profile.addfavorite')%"),$("#favoriteProfilebox"+b.data("userId")).remove()):""!==a.message?alert(a.message):alert("%GETTEXT('profile.remotecallfailed')%")}).fail(function(){alert("%GETTEXT('profile.remotecallfailed')%")})}};
vc.ui={title:"",titleCount:0,passwords:[],init:function(){vc.ui.title=window.document.title;vc.ui.updateTitle();var a=$(".jNewMessages"),b=$(".jOpenFriendRequests"),c=$(".jGroupNotifications");$.datepicker.regional.de={clearText:"l\u00f6schen",clearStatus:"aktuelles Datum l\u00f6schen",closeText:"schlie\u00dfen",closeStatus:"ohne \u00c4nderungen schlie\u00dfen",prevText:"<zur\u00fcck",prevStatus:"letzten Monat zeigen",nextText:"Vor>",nextStatus:"n\u00e4chsten Monat zeigen",currentText:"heute",currentStatus:"",
monthNames:"Januar Februar M\u00e4rz April Mai Juni Juli August September Oktober November Dezember".split(" "),monthNamesShort:"Jan Feb M\u00e4r Apr Mai Jun Jul Aug Sep Okt Nov Dez".split(" "),monthStatus:"anderen Monat anzeigen",yearStatus:"anderes Jahr anzeigen",weekHeader:"Wo",weekStatus:"Woche des Monats",dayNames:"Sonntag Montag Dienstag Mittwoch Donnerstag Freitag Samstag".split(" "),dayNamesShort:"So Mo Di Mi Do Fr Sa".split(" "),dayNamesMin:"So Mo Di Mi Do Fr Sa".split(" "),dayStatus:"Setze DD als ersten Wochentag",
dateStatus:"W\u00e4hle D, M d",dateFormat:"dd.mm.yy",firstDay:1,initStatus:"W\u00e4hle ein Datum",isRTL:!1};$.datepicker.setDefaults($.extend({dateFormat:"%GETTEXT('javascript.ui.datepicker.format')%",changeMonth:!0,changeYear:!0},$.datepicker.regional["%GETTEXT('javascript.ui.datepicker.locale')%"]));(0<a.length||0<b.length||0<c.length)&&null!=vc.websocket.key&&vc.websocket.attach("%ENTITY_TYPE_STATUS%",null,vc.ui.updateAccountStatus,12E3);vc.ui.updateUI();vc.ui.initJsTabs();vc.ui.initForms();$("body").on("click",
"a.jMenu",function(a){a.preventDefault();$("#sidebars").toggle()});$("#notify").on("mouseenter",".popup.jHoverTrigger",vc.ui.loadReloadSubmenu);$("body").on("focus","#notify .popup .jTrigger",vc.ui.closeMenu);$("body").on("focus",".popup .jTrigger",vc.ui.loadReloadSubmenu);$("body").on("mousedown",".popup .jTrigger",vc.ui.unfocus);$("body").on("click",".notifyNews .close",vc.ui.notifyClose);$("body").on("click","nav.actionBar",vc.ui.toggleActionBar);$("body").on("change","select[data-filter-field]",
vc.ui.filterSelectTrigger);$("body").on("click",".jDeleteColor",vc.ui.deleteColor);$("body").on("click","#blockTip nav .prev",{direction:-1},vc.ui.changeTip);$("body").on("click","#blockTip nav .next",{direction:1},vc.ui.changeTip);$("body").on("click",".ajaxUpload .delete",vc.fileupload.remove);$("body").on("click",".jFileuploadTrigger",vc.fileupload.trigger);$("body").on("click",".ajaxUpload",vc.fileupload.open);$("body").on("click",".ajaxUpload img",vc.fileupload.open);$("body").on("change",".ajaxUploadSelect",
vc.fileupload.upload);$("body").on("focus","form .location > input",vc.ui.form.location.focus);$("body").on("click",vc.ui.form.location.closePopup);$("body").on("click","form .location .addresspopup",vc.ui.form.location.clickPopup);$("body").on("change","form input[type=checkbox].jAutoSubmit",vc.ui.form.autoSubmit);$("body").on("focusout","form input[type=text].jAutoSubmit",vc.ui.form.autoSubmit);$("body").on("click","a.addFavorite",vc.favorites.add);$("body").on("click","a.deleteFavorite",vc.favorites.remove);
$("body").on("click","a.addFriend",vc.friends.add);$("body").on("click","a.cancelFriend",vc.friends.cancel);$("body").on("click","a.confirmFriend",vc.friends.confirm);$("body").on("click","a.denyFriend",vc.friends.deny);$("body").on("click","a.deleteFriend",vc.friends.remove);$("body").on("click","a.jSet",vc.ui.set);$("body").on("click","a.jSubmit",vc.ui.confirmForm);$("body .cookies").on("click",".close",vc.ui.cookieConfirm);$("body").on("keyup",".datepicker .day,.datepicker .month,.datepicker .year",
vc.ui.updateDateFocus);$("body").on("paste",".datepicker .day,.datepicker .month,.datepicker .year",vc.ui.updateDateFocus);$("body").on("change",".datepicker .day,.datepicker .month,.datepicker .year",vc.ui.updateDateFocus);$("body").on("input",".datepicker .day,.datepicker .month,.datepicker .year",vc.ui.updateDateFocus);$("body .cookies").on("click",".close",vc.ui.cookieConfirm);vc.ui.collapse.init()},updateAccountStatus:function(){var a=$(".jNewMessages"),b=$(".jNewMessages span"),c=$(".jMods"),
d=$(".jMods span"),e=$(".jOpenFriendRequests"),f=$(".jOpenFriendRequests span"),g=$(".jEventNotifications"),m=$(".jEventNotifications span"),h=$(".jGroupNotifications"),n=$(".jGroupNotifications span"),s=$(".jTicketNotifications"),t=$(".jTicketNotifications span"),v=$("a",s.parent());$.get("%PATH%account/status/",[],function(l,p,r){p=0;void 0==l.messages||0==l.messages?a.hide():(p+=l.messages,b.text(l.messages),a.show());void 0==l.friends||0==l.friends?e.hide():(p+=l.friends,f.text(l.friends),e.show());
void 0==l.friends||0==l.friends?e.hide():(p+=l.friends,f.text(l.friends),e.show());void 0==l.events||0==l.events?g.hide():(p+=l.events,m.text(l.events),g.show());void 0==l.groups||0==l.groups?h.hide():(p+=l.groups,n.text(l.groups),h.show());void 0==l.tickets||0==l.tickets?(v.attr("href",v.data("inactive")),s.hide()):(v.attr("href",v.data("active")),p+=l.tickets,t.text(l.tickets),s.show());void 0!==l.mod&&(r=l.mod.tickets+l.mod.real+l.mod.spam+l.mod.groups,0==r?c.hide():(p+=r,d.text(l.mod.tickets+
"|"+(l.mod.real+l.mod.spam+l.mod.groups)),c.show()),$(".jModTickets span").text(l.mod.tickets),$(".jModPms span").text(l.mod.pm),$(".jModReals span").text(l.mod.real),$(".jModSpam span").text(l.mod.spam),$(".jModFlag span").text(l.mod.flag),$(".jModGroups span").text(l.mod.groups),$(".jModPicsUnchecked span").text(l.mod.picsUnchecked),$(".jModPicsPrewarned span").text(l.mod.picsPrewarned),$(".jModToldAFriend span").text(l.mod.toldafriend));vc.ui.titleCount=p;vc.ui.updateTitle()})},updateTitle:function(){$(document).ready(function(){window.document.title=
0==vc.ui.titleCount?vc.ui.title:"("+vc.ui.titleCount+") "+vc.ui.title})},initJsTabs:function(){$(".jTabs").each(function(a,b){$("a",b).bind("click",function(a){a.preventDefault();$("a",b).each(function(a,b){$("#"+$(b).data("tab")).hide();$(b).removeClass("active")});var d=$("#"+$(a.target).data("tab"));d.show();$("textarea",d).trigger("input");$(a.target).addClass("active")})})},updateUI:function(){$("a.jZoom").fancybox({titlePosition:"over",transitionIn:"elastic",transitionOut:"elastic",hideOnContentClick:!0,
padding:0,helpers:{overlay:{locked:!1}},beforeShow:function(){$.fancybox.wrap.bind("contextmenu",function(a){return!1});$.fancybox.wrap.bind("dragstart",function(a){return!1})}});vc.ui.initAutoHeight($("textarea.jAutoHeight"));$(".datepicker").each(function(a,b){var c=$(b),d=new Date,e=new Date;d.setTime(d.getTime()+864E5*c.data("date-start"));e.setTime(e.getTime()+864E5*c.data("date-end"));$("input[type=text]",b).datepicker({minDate:c.data("date-start"),maxDate:c.data("date-end"),yearRange:d.getFullYear()+
":"+e.getFullYear(),onSelect:function(a,b){var c=b.input.closest(".datepicker");$(".day",c).val(b.selectedDay);$(".month",c).val(b.selectedMonth+1);$(".year",c).val(b.selectedYear)}})});$(".clockpicker").clockpicker({placement:"top",autoclose:!0});$(".colorpicker").minicolors({letterCase:"uppercase"})},updateDateFocus:function(a){var b=$(this),c=b.closest(".datepicker");""==b.val()&&8==a.keyCode?b.hasClass("month")?$(".day",c).focus():b.hasClass("year")&&$(".month",c).focus():b.hasClass("day")&&3<
b.val()?$(".month",c).focus():b.hasClass("month")&&1<b.val()&&$(".year",c).focus()},initForms:function(){$.each($("select[data-filter-field]"),function(a,c){vc.ui.filterSelectUpdate($(c))});$.each($(".rows"),function(a,c){$('input[name="'+$(c).data("delete")+'"]').on("change",function(a){vc.ui.updateFormsMultiple($(a.target).parents(".rows"))});vc.ui.updateFormsMultiple(c)});$(".dnd").sortable({axis:"y",handle:".sorter",create:vc.ui.sortableUpdated,update:vc.ui.sortableUpdated});var a=$('input[name="password[0]"]');
a.length&&($.get("/files/passwords.json",{},function(a,c,d){vc.ui.passwords=a}),a.on("change keyup, paste input",vc.ui.updatePasswordStrength),a.trigger("keyup",[13]))},initAutoHeight:function(a){$.each(a,function(a,c){var d=c.offsetHeight-c.clientHeight;$(c).on("change keyup, paste input",function(){vc.ui.updateAutoHeight(this,d)}).removeClass("jAutoHeight");vc.ui.updateAutoHeight(this,d)})},updateAutoHeight:function(a,b){var c=$(a),d=a.scrollHeight+b+"px";""===c.val()?c.css("height","auto"):c.css("height")!==
d&&c.css("height","auto").css("height",d)},updateFormsMultiple:function(a){var b=$(a).data("delete");existingElements=$('input[name="'+b+'"]',a).length;deletedElements=$('input[name="'+b+'"]:checked',a).length;remainingElements=existingElements-deletedElements;newElements=$(".jNewMultiple",a);displayNewElements=newElements.length-remainingElements;$.each(newElements,function(a,b){a<displayNewElements?$(b).show():$(b).hide()})},sortableUpdated:function(a,b){$.each($(".row",$(a.target).parent()),function(a,
b){$('input[type="hidden"].jWeight',b).val(a+1)})},updatePasswordStrength:function(a){var b=$(a.target);a=b.closest("form");var c=b.val(),b=$(".passwordStrength",b.closest("li")),d=$(".bar div",b),e=$(".verdict",b),f=$("ul",b);""===c?b.is(":visible")&&b.slideUp("slow"):(a=vc.ui.evaluatePasswordStrength($('input[name="nickname"]',a).val(),$('input[name="email"]',a).val(),$('input[name="city"]',a).val(),c,b.data("specialchars")),d.attr("class",a.indicatorClass),d.css("width",Math.max(20,a.strength)+
"%"),e.text(a.indicatorText),0===a.message.length?(f.hide(),f.html("")):(f.html("<li>"+a.message.join("</li><li>")+"</li>"),f.show()),b.is(":visible")||b.slideDown("slow"))},evaluatePasswordStrength:function(a,b,c,d,e){d=d.trim();var f,g,m=0,h=100,n=[],s=/[a-z]/.test(d),t=/[A-Z]/.test(d),v=/[0-9]/.test(d),l=/[^a-zA-Z0-9]/.test(d),p=!1;$.each(vc.ui.passwords,function(){if(d==this)return p=!0,!1});p&&(n.push("%GETTEXT('form.passwordStrength.tip.custom.blacklist')%"),h=5);var r=d.toLowerCase();a=a.toLowerCase();
b=b.toLowerCase();c=c.toLowerCase();if(""!==d&&(r===a||-1!==a.indexOf(r)))n.push("%GETTEXT('form.passwordStrength.tip.custom.username')%"),h=5;else if(""!==b&&(r===b||-1!==b.indexOf(r)))n.push("%GETTEXT('form.passwordStrength.tip.custom.email')%"),h=5;else if(""!==c&&(r===c||-1!==c.indexOf(r)||-1!==r.indexOf(c)))n.push("%GETTEXT('form.passwordStrength.tip.custom.city')%"),h=5;5>d.length?(n.push("%GETTEXT('form.passwordStrength.tip.length')%"),h=5):12>d.length&&(n.push("%GETTEXT('form.passwordStrength.tip.length')%"),
h-=5*(12-d.length));s||(n.push("%GETTEXT('form.passwordStrength.tip.lowercase')%"),m++);t||(n.push("%GETTEXT('form.passwordStrength.tip.uppercase')%"),m++);v||(n.push("%GETTEXT('form.passwordStrength.tip.numbers')%"),m++);l||(n.push("%GETTEXT('form.passwordStrength.tip.specialchars')%<span class=\"specialchars\">"+e+"</span>"),m++);switch(m){case 1:h-=12.5;break;case 2:h-=25;break;case 3:h-=40;break;case 4:h-=40}60>h?(f="%GETTEXT('form.passwordStrength.weak')%",g="weak"):70>h?(f="%GETTEXT('form.passwordStrength.fair')%",
g="fair"):80>h?(f="%GETTEXT('form.passwordStrength.good')%",g="good"):100>h?(f="%GETTEXT('form.passwordStrength.strong')%",g="strong"):100===h&&(f="%GETTEXT('form.passwordStrength.verystrong')%",g="verystrong");return{strength:h,message:n,indicatorText:f,indicatorClass:g}},closeMenu:function(a){"absolute"===$("#sidebars").css("position")&&$("#sidebars").hide()},loadReloadSubmenu:function(a){$.each($(".jReload",$(a.target).parent()),function(a,c){var d=$(c),e=d.data("url");d.html("<li class=\"jLoading\">%GETTEXT('js.loading')%</li>");
$.get(e,{},function(a,b,c){d.html(a);vc.timeago.update(d)}).fail(function(){d.html("<li class=\"failed\"><p>%GETTEXT('menu.reload.failed')%</p></li>")})})},toggleActionBar:function(a){var b=$(a.target);"NAV"==b.prop("tagName")&&(a.preventDefault(),b.hasClass("expanded")?b.removeClass("expanded"):b.addClass("expanded"),$("a span",b).animate({width:"toggle"},1E3))},notifyClose:function(a){a.preventDefault();$.post($(a.target).data("url"),[],function(b,c){b.success&&$(a.target).closest("div").hide()})},
unfocus:function(a){var b=$(a.target);b.is(":focus")&&(a.preventDefault(),b.blur())},filterSelectTrigger:function(a){vc.ui.filterSelectUpdate($(a.target))},deleteColor:function(a){a.preventDefault();$('input[name="colors['+$(a.target).data("color")+']"]').minicolors("value","")},changeTip:function(a){a.preventDefault();var b=$(".jsTip",$(a.target).closest("#blockTip"));a=b.data("current")+a.data.direction;0>a?a=vc.block.tips.length-1:a>=vc.block.tips.length&&(a=0);$(".index",b).text(a+1);$(".body",
b).text(vc.block.tips[a]);b.data("current",a)},filterSelectUpdate:function(a){var b=$("option:selected",a).data("filter-group");a=$('select[name="'+a.data("filter-field")+'"]',a.closest("form"));var c=$("optgroup",a);if(void 0==b)a.val("");else{var b="#"+a.attr("id")+"-g-"+b,d=$(b,a),c=c.not(b);d.show();0==d.has('option[value="'+a.val()+'"]').length&&a.val("")}c.hide()},set:function(a){a.preventDefault();var b=$(a.target);$.post("%PATH%account/set/"+b.data("set")+"/",{},function(a,d,e){d=b.data("hide");
a=b.data("hide-message");void 0!==d&&(d=b.closest(d),1==d.length&&(d.hide(),void 0!==a&&alert(a)));a=b.closest(".notifyNews");1==a.length&&$(".close",a).trigger("click")})},printMil:function(a,b,c,d){d="lto:"+d+"@"+(b+"."+c+'">'+d);d=d+"@"+b+"."+c;d+="</a>";d='<a href="mai'+d;$("."+a).html(d)},openAll:function(){if(!0==confirm("%GETTEXT('result.openall.confirm')%"))for(var a=0;a<vc.ui.profilesToOpen.length;a++)window.open("%PATH%user/view/"+vc.ui.profilesToOpen[a]+"/")},confirmForm:function(a){a.preventDefault();
$(a.target).closest("form").submit()},collapse:{init:function(){if(localStorage){var a=localStorage.getItem("collapseMenu");null!==a&&""!==a&&$.each(a.split(","),function(a,c){""!==c&&($("#"+c).hide(),$('.collapsible[data-area="'+c+'"]').removeClass("collapsible").addClass("collapsed"))});a=localStorage.getItem("collapseBlock");null!==a&&""!==a&&$.each(a.split(","),function(a,c){""!==c&&$("#"+c).removeClass("collapsible").addClass("collapsed")})}$("body").on("click",".collapsible > h2, .collapsible > h3",
{store:!1},vc.ui.collapse.collapse);$("body").on("click",".block.collapsible h3",{store:!0},vc.ui.collapse.collapse);$("body").on("click",".collapsed > h2, .collapsed > h3",{store:!1},vc.ui.collapse.expand);$("body").on("click",".block.collapsed h3",{store:!0},vc.ui.collapse.expand);$("body").on("click","#userNav nav .collapsible, #userNav nav .collapsed",vc.ui.collapse.toggleCollapse)},collapse:function(a){var b=$(a.target).closest(".collapsible"),c=$("> div",b),d=b.attr("id");c.slideUp("fast");
b.addClass("collapsed");b.removeClass("collapsible");d&&a.data.store&&vc.localStorage.add("collapseBlock",d)},expand:function(a){var b=$(a.target).closest(".collapsed"),c=$("> div",b),d=b.attr("id");c.slideDown("fast");b.addClass("collapsible");b.removeClass("collapsed");d&&a.data.store&&vc.localStorage.remove("collapseBlock",d)},toggleCollapse:function(a){a=$(a.target);var b=a.data("area"),b=$("#"+b);a.hasClass("collapsed")?(b.slideDown("fast"),a.addClass("collapsible"),a.removeClass("collapsed"),
vc.localStorage.remove("collapseMenu",a.data("area"))):(b.slideUp("fast"),a.addClass("collapsed"),a.removeClass("collapsible"),vc.localStorage.add("collapseMenu",a.data("area")))}},form:{autoSubmit:function(a){$(a.target).closest("form").submit()},location:{focus:function(a){var b=$(a.target).closest(".location");a=$(".addresspopup",b);var b=$(".addresspicker",b),c=$("#"+b.attr("id")+"-caption");a.is(":visible")||(c.val(b.val()),b.val(""),b.prop("readonly",!0),a.slideDown())},clickPopup:function(a){a.stopPropagation()},
closePopup:function(a){if(0==$(a.target).closest(".location").length){var b=$(".addresspopup:visible").closest(".location");if(0<b.length){a=$(".addresspopup",b);var b=$(".addresspicker",b),c=$("#"+b.attr("id")+"-caption");a.is(":visible")&&(b.val(c.val()),c.val(""),b.prop("readonly",!1),a.slideUp())}}}}},cookieConfirm:function(a){a.preventDefault();$(".cookies").slideUp("slow");a=new Date((new Date).getTime()+31536E6);document.cookie="cc=1; path=/; expires="+a.toGMTString()}};$(document).ready(function(){vc.ui.init()});
vc.fileupload={open:function(a){a.preventDefault();a=$(a.target).parent();a.hasClass("ajaxUpload")&&(a=a.parent());$(".ajaxUploadSelect",a).focus().trigger("click")},trigger:function(a){a.preventDefault();$(".ajaxUploadSelect",$(a.target).closest("form")).focus().trigger("click")},upload:function(a){var b=$(a.target),c=b.context.files,d=b.parent();a=$(".ajaxUpload",d);var e=$(".ajaxUploadPreview",d),f=$(".ajaxUploadFile",d),b=b.data("maxSize"),g=a.data("filename"),m=a.data("delete");if(window.XMLHttpRequest&&
window.FormData){var d=new FormData,h=new XMLHttpRequest;if(0<c.length)if(c=c[0],c.type.match("image.*"))if(c.size>b)alert("%GETTEXT('upload.toobig')%");else{d.append("file",c,c.name);var n=$('<div class="jLoading"></div>');e.append(n);h.open("POST",a.data("path"),!0);h.onload=function(){n.remove();if(200===h.status){var a=$.parseJSON(h.response);a.success?($("img",e).remove(),$("span.filename",e).remove(),$("a.delete",e).remove(),f.val(a.filename),e.append('<img src="/picture/temp/crop/74/74/'+a.filename+
'" />'),g&&e.append('<span class="filename">'+a.sourcename+"</span>"),m&&e.append('<a class="delete" href="#"></a>')):null!=a.message?alert(a.message):alert("%GETTEXT('upload.error')%")}else alert("%GETTEXT('upload.error')% ["+h.status+"]")};h.send(d)}else alert("%GETTEXT('upload.noimage')%")}else alert("%GETTEXT('upload.incompatible')%")},remove:function(a){a.preventDefault();a=$(a.target).closest(".ajaxUploadPreview").parent();var b=$(".ajaxUploadPreview",a);$(".ajaxUploadFile",a).val("");b.empty()}};
vc=vc||{};
vc.websocket={key:null,socket:null,connected:!1,retry:0,listeners:[],attach:function(a,b,c,d){null==vc.websocket.socket&&(vc.websocket.socket=!1);!1==vc.websocket.socket?window.setInterval(function(){c()},d):(vc.websocket.connected&&vc.websocket.socket.send({contextType:a,contextId:b,key:vc.websocket.key}),vc.websocket.listeners.push({contextType:a,contextId:b,callback:c,fallbackTime:d}))},init:function(){try{vc.websocket.socket=new WebSocket("wss://%WEBSOCKET_SERVER%:%WEBSOCKET_PORT%/worker"),vc.websocket.socket.onopen=
function(){console.log("Websocket opened");vc.websocket.connected=!0;vc.websocket.retry=0;$.each(vc.websocket.listeners,function(a,c){vc.websocket.socket.send(JSON.stringify({contextType:c.contextType,contextId:c.contextId,key:vc.websocket.key}))})},vc.websocket.socket.onmessage=function(a){console.log("Websocket message");console.log(a);try{var c=JSON.parse(a.data);$.each(vc.websocket.listeners,function(a,b){b.contextType==c[0]&&b.contextId==c[1]&&b.callback()})}catch(d){}},vc.websocket.socket.onclose=
function(a){console.log("Websocket closed");console.log(a);vc.websocket.connected&&3>vc.websocket.retry?(vc.websocket.retry++,window.setTimeout(vc.websocket.init,1E3*vc.websocket.retry)):(vc.websocket.socket=!1,vc.websocket.connected=!1,vc.websocket.initFallbacks())}}catch(a){vc.websocket.socket=!1}$(window).unload(vc.websocket.quit)},initFallbacks:function(){$.each(vc.websocket.listeners,function(a,b){window.setInterval(function(){b.callback()},b.fallbackTime)})},quit:function(){null!=vc.websocket.socket&&
!1!=vc.websocket.socket&&(vc.websocket.connected=!1,vc.websocket.listeners=[],vc.websocket.socket.close())}};vc=vc||{};
vc.pm={threads:{min:0,max:0,map:[],filter:{}},messages:{min:0,max:0,filter:{}},design:"",activeHash:"",activeThread:0,filterOutgoing:0,profiles:null,title:["",""],f:[],fT:[],drafts:[],loadingThreads:!1,loadingMessages:!1,init:function(a,b,c,d){vc.pm.design=a;vc.pm.activeHash="#"+b;vc.pm.activeThread=b;vc.pm.filterOutgoing=c;vc.pm.f={};"function"===typeof atob&&$.each(JSON.parse(atob("%FILTER_KEYWORDS%")),function(a,b){vc.pm.f[a]=[];$.each(b,function(){vc.pm.f[a].push(RegExp("(^|[^w])"+this+"($|[^w])",
"i"))})});$(document).ready(function(){vc.pm.title=vc.ui.title.split("|");0==b&&($("#inboxControl .recipients").hide(),$(".jPmMessages .jLoading").hide());window.setInterval(function(){window.location.hash!=vc.pm.activeHash&&("#"!=window.location.hash&&""!=window.location.hash)&&("absolute"===$("#sidebars").css("position")&&$("#sidebars").hide(),vc.pm.activeHash=window.location.hash,vc.pm.activeThread=window.location.hash.replace(/#/g,""),$(".jThread").removeClass("active"),$("#jThread"+vc.pm.activeThread).addClass("active"),
$(".jPmMessages .jLoading").show(),$(".jPmMessages .jMessage").remove(),$(".jPmMessages .draft").remove(),vc.pm.messages.min=0,vc.pm.messages.max=0,vc.pm.drafts=[],vc.pm.loadingMessages=!1,vc.pm.loadPreviousMessages())},500);""!=window.location.hash&&"#"!=window.location.hash?(vc.pm.activeHash=window.location.hash,vc.pm.activeThread=window.location.hash.replace(/#/g,"")):0<d.length&&(vc.pm.activeHash="#"+d[0].contact.id,vc.pm.activeThread=d[0].contact.id);vc.pm.updateScrollbars();$(window).resize(vc.pm.updateScrollbars);
$(".jReplyForm textarea").on("change keyup, paste input",vc.pm.updateTextarea);$(".scrollbar").enscroll({showOnHover:!0,scrollIncrement:40,verticalTrackClass:"track",verticalHandleClass:"handle",addPaddingToPane:!1});$("#pmThreads form.threadFilter").on("submit",vc.pm.filterThreads);vc.pm.fillThreads(d,!0);$(".jPmThreads").height()<$("#inboxList").height()&&$(".jPmThreads .jLoading").hide();0<vc.pm.activeThread&&$("#jThread"+vc.pm.activeThread).addClass("active");vc.pm.loadPreviousMessages();$(".jPmThreads").closest(".scrollbar").scroll(function(a){a=
$(".jPmThreads");var b=a.closest(".scrollbar");25>=a.height()-(b.height()+b.scrollTop())&&vc.pm.loadNextThreads()});$(".jPmMessages").scroll(function(a){25>$(".jPmMessages").scrollTop()&&vc.pm.loadPreviousMessages()});$("#inboxControl .actions").on("click",".filter",vc.pm.actions.toggleFilter);$("#inboxControl .actions").on("click",".block",vc.pm.actions.blockUsers);$("#inboxControl .actions").on("click",".deleteConversation",vc.pm.actions.deleteConversation);$("#inboxControl .filterDialog form").on("submit",
vc.pm.submitFilterForm);$("#inboxControl .filterDialog form button[type='reset']").on("click",vc.pm.resetFilter);$("#inboxList .jNotifications").on("click",".jClose",vc.pm.notifications.close);$(".jPmMessages").on("click",".jMessage a.delete",vc.pm.actions.trashmail);$(".jPmMessages").on("click",".jMessage a.flag",vc.pm.actions.markspam);$("#inboxList").on("click",".draft .edit",vc.pm.draft.edit);$("#inboxList").on("click",".draft .delete",vc.pm.draft.remove);$("#inboxList").on("click",".undo",vc.pm.actions.undo);
if(vc.pm.filterOutgoing)$(".jReplyForm textarea").on("change keyup, paste input",vc.pm.updateWarning);$(".jReplyForm").submit(vc.pm.submitForm);$(".jReplyForm .saveDraft").on("click",vc.pm.draft.add);vc.websocket.attach("%ENTITY_TYPE_PM%",null,vc.pm.checkNewThreadsAndMessages,5E3)})},updateTextarea:function(a){localStorage&&(a=$(a.target).val(),""===a?localStorage.removeItem("pm."+vc.pm.activeThread):localStorage.setItem("pm."+vc.pm.activeThread,a));vc.pm.updateScrollbars()},updateScrollbars:function(){$.each($(".scrollbar"),
function(){var a=$(this),b=a.closest(".bodyW"),c=a.parent(),d=$(b).height(),b=$("#inboxControl");if(null!==d){var e=$("main");0<e.length&&(d-=e.innerHeight()-e.height());"inboxList"===c.attr("id")&&"none"===b.css("float")&&(d-=b.outerHeight(!0));$.each(c.children(),function(){var a=$(this);!a.hasClass("scrollbar")&&"absolute"!=a.css("position")&&(d-=a.outerHeight(!0))});$(a).css("height",d)}})},loadNextThreads:function(){!1==vc.pm.loadingThreads&&(vc.pm.loadingThreads=!0,$.get("%PATH%pm/threads/",
{before:vc.pm.threads.min,f:vc.pm.threads.filter},function(a,b,c){vc.pm.fillThreads(a.threads,!0);a.isLast&&$(".jPmThreads .jLoading").hide()}).fail(function(a,b,c){vc.pm.notifications.add("error","%GETTEXT('mailbox.remotecallfailed')% [#1001/"+a.status+"/"+b+"/"+c+"]")}).always(function(){vc.pm.loadingThreads=!1}))},filterThreads:function(a){a.preventDefault();var b=$("input[name=namefilter]",a.target).val();a=$("input[name=newfilter]",a.target).is(":checked");vc.pm.threads.filter={};""!==b&&(vc.pm.threads.filter.name=
b);a&&(vc.pm.threads.filter.unread=!0);$("ul.jPmThreads .jThread").remove();vc.pm.threads.min=Math.ceil(Date.now()/1E3);vc.pm.threads.max=0;vc.pm.threads.map=[];vc.pm.loadNextThreads()},fillThreads:function(a,b){var c=$("#jPmThreadsTemplate").html(),d=$(".jPmThreads"),e=$(".jPmThreads .jLoading");$.each(a,function(a,g){g.contact.id==vc.pm.activeThread&&(g.activeThread=!0);$("#jThread"+g.contact.id).remove();rendered=Mustache.to_html(c,g);b?e.before(rendered):d.prepend(rendered);if(0==vc.pm.threads.min||
g.created<vc.pm.threads.min)vc.pm.threads.min=g.created;if(0==vc.pm.threads.max||g.created>vc.pm.threads.max)vc.pm.threads.max=g.created;vc.pm.threads.map[g.contact.id]=g});vc.timeago.update(d)},loadPreviousMessages:function(){!1==vc.pm.loadingMessages&&0<vc.pm.activeThread&&(vc.pm.loadingMessages=!0,$.get("%PATH%pm/messages/"+vc.pm.activeThread+"/",{before:vc.pm.messages.min,f:vc.pm.messages.filter},function(a,b,c){$("#jThread"+vc.pm.activeThread).removeClass("new");vc.pm.profiles=a.profiles;!1==
vc.pm.profiles[vc.pm.activeThread].isActive?$(".jReplyForm").hide():void 0!==a.blocked&&(null===a.blocked?$(".jReplyForm").show():(vc.pm.notifications.add("warning",a.blocked),$(".jReplyForm").hide()));vc.pm.fillMessages(a.messages,void 0===a.drafts?[]:a.drafts,!1);a.isLast&&$(".jPmMessages .jLoading").hide()}).fail(function(a,b,c){vc.pm.notifications.add("error","%GETTEXT('mailbox.remotecallfailed')% [#1002/"+a.status+"/"+b+"/"+c+"]")}).always(function(){vc.pm.loadingMessages=!1}))},fillMessages:function(a,
b,c){var d=$("#inboxControl .actions"),e=$("#inboxControl .actions .pdfExport"),f=$(".jConversation"),g=$("#jPmMessagesTemplate").html(),m="",h=$(".jPmMessages"),n=$(".jPmMessages .jLoading"),s=0==vc.pm.messages.min;d.data("contact",vc.pm.activeThread);f.html(vc.pm.profiles[vc.pm.activeThread].nickname);f.attr("href","%PATH%user/view/"+vc.pm.activeThread+"/");0<$("#inboxControl .filterDialog").length&&e.attr("href","%PATH%pm/pdfexport/"+vc.pm.activeThread+"/");$("#inboxControl .recipients").show();
$.each(a,function(a,b){if(b.senderid==vc.pm.activeThread||b.recipientid==vc.pm.activeThread){$("#jMessage"+b.id).remove();b.sender=vc.pm.profiles[b.senderid];b.senderid==vc.pm.activeThread&&(b.received=!0);b.preFlagMessage=null===b.preFlag?null:"sx"===b.preFlag?"%GETTEXT('mailbox.warning.sex')%":"insult"===b.preFlag?"%GETTEXT('mailbox.warning.insult')%":null;m+=Mustache.to_html(g,b);if(0==vc.pm.messages.min||b.id<vc.pm.messages.min)vc.pm.messages.min=b.id;if(0==vc.pm.messages.max||b.id>vc.pm.messages.max)vc.pm.messages.max=
b.id}});$.each(b,function(a,b){vc.pm.drafts[a]=b;$(".jPmMessages").append(Mustache.to_html($("#jPmDraftTemplate").html(),{id:a,type:"store",text:b}))});s&&localStorage&&(b=localStorage.getItem("pm."+vc.pm.activeThread),""!==b&&null!==b&&(m+=Mustache.to_html($("#jPmDraftTemplate").html(),{id:"local",type:"local",text:b})));c?h.append(m):n.after(m);if(s||c){c=$(".jPmMessages");a=$(".jPmMessages .jMessage, .jPmMessages .draft");var t=0;$.each(a,function(a,b){t+=$(b).outerHeight(!0)});c.scrollTop(t-c.height())}else{c=
$(".jPmMessages");var v=c.scrollTop();$.each(a,function(a,b){v+=$("#jMessage"+b.id).outerHeight(!0)});c.scrollTop(v)}vc.timeago.update(h);vc.ui.title=vc.pm.title[0]+"("+vc.pm.profiles[vc.pm.activeThread].nickname+") |"+vc.pm.title[1];vc.ui.updateTitle()},checkNewThreadsAndMessages:function(){$.get("%PATH%pm/threads/",{after:vc.pm.threads.max,f:vc.pm.threads.filter},function(a,b,c){if(0<a.threads.length){vc.pm.fillThreads(a.threads,!1);var d=!1;$.each(a.threads,function(a,b){vc.pm.activeThread==b.contact.id&&
(d=!0)});0<vc.pm.activeThread&&d&&$.get("%PATH%pm/messages/"+vc.pm.activeThread+"/",{after:vc.pm.messages.max,f:vc.pm.messages.filter},function(a,b,c){$("#jThread"+vc.pm.activeThread).removeClass("new");vc.pm.profiles=a.profiles;vc.pm.fillMessages(a.messages,[],!0)})}})},submitFilterForm:function(a){a.preventDefault();var b=$('input[name="from[date][year]"]',a.target).val(),c=$('input[name="from[date][month]"]',a.target).val(),d=$('input[name="from[date][day]"]',a.target).val(),e=$('input[name="from[time]"]',
a.target).val(),f=$('input[name="to[date][year]"]',a.target).val(),g=$('input[name="to[date][month]"]',a.target).val(),m=$('input[name="to[date][day]"]',a.target).val(),h=$('input[name="to[time]"]',a.target).val();a=$('input[name="textfilter"]',a.target).val();var n=!1;vc.pm.messages.filter={};""!=a&&(vc.pm.messages.filter.text=a,n=!0);try{""!==b&&(""!==c&&""!==d)&&(vc.pm.messages.filter.from=(new Date(b,c,d,0,0,0,0)).getTime()/1E3,""!==e&&(vc.pm.messages.filter.from+=vc.date.parseTime(e)),n=!0),
""!==f&&(""!==g&&""!==m)&&(vc.pm.messages.filter.to=(new Date(f,g-1,m,0,0,0,0)).getTime()/1E3,""!==h&&(vc.pm.messages.filter.to+=vc.date.parseTime(h)),n=!0),$(".jPmMessages .jLoading").show(),$(".jPmMessages .jMessage").remove(),$(".jPmMessages .draft").remove(),vc.pm.messages.min=0,vc.pm.messages.max=0,vc.pm.loadingMessages=!1,vc.pm.loadPreviousMessages(),$("#inboxControl .filterDialog").hide(),n?$("#inboxControl .actions a.filter").addClass("active"):$("#inboxControl .actions a.filter").removeClass("active")}catch(s){vc.pm.notifications.add("error",
"%GETTEXT('mailbox.filterfailed')%")}},resetFilter:function(a){vc.pm.messages.filter={};$(".jPmMessages .jLoading").show();$(".jPmMessages .jMessage").remove();$(".jPmMessages .draft").remove();vc.pm.messages.min=0;vc.pm.messages.max=0;vc.pm.loadingMessages=!1;vc.pm.loadPreviousMessages();$("#inboxControl .actions a.filter").removeClass("active")},updateWarning:function(a){var b=$(".jReplyForm textarea").val().toLowerCase();$.each(vc.pm.f,function(a){-1==vc.pm.fT.indexOf(a)&&$.each(this,function(){b.match(this)&&
-1===vc.pm.threads.map[vc.pm.activeThread].unfilter.indexOf(a)&&(vc.pm.fT.push(a),"sx"===a?vc.pm.notifications.add("warning","%GETTEXT('mailbox.warning.sex')%"):"insult"===a&&vc.pm.notifications.add("warning","%GETTEXT('mailbox.warning.insult')%"))})})},submitForm:function(a){a.preventDefault();a=$(".jReplyForm textarea").val();""!==a&&vc.pm.sendMessage(a)},sendMessage:function(a){var b=$(".jReplyForm textarea"),c=$(".jReplyForm button");b.prop("disabled",!0);c.hide();$(".jReplyForm .jLoading").show();
b.trigger("keyup");$.post("%PATH%pm/add/",{contact:vc.pm.activeThread,message:a,maxThread:vc.pm.threads.max,maxMessage:vc.pm.messages.max},function(a,c,f){!0==a.success?(localStorage&&localStorage.removeItem("pm."+vc.pm.activeThread),b.val(""),vc.pm.fillThreads(a.add.threads,!1),vc.pm.fillMessages(a.add.messages,[],!0)):vc.pm.notifications.add("error",a.message)}).fail(function(a,b,c){vc.pm.notifications.add("error","%GETTEXT('mailbox.remotecallfailed')% [#1003/"+a.status+"/"+b+"/"+c+"]")}).always(function(){b.prop("disabled",
!1);$(".jReplyForm .jLoading").hide();c.show()})},notifications:{add:function(a,b,c){"success"==a?a+=" notifySuccess":"info"==a?a+=" notifyInfo":"warning"==a?a+=" notifyWarn":"error"==a&&(a+=" notifyError");var d=$("#jPmNotificationTemplate").html();a=Mustache.to_html(d,{type:a,text:b,undo:c});$("#inboxList .jNotifications").append(a);$("#inboxList .jNotifications div:last").slideDown("slow")},close:function(a){$(a.target).parent("div").remove()}},actions:{blockUsers:function(a){a.preventDefault();
$.post("%PATH%block/add/",{profileid:vc.pm.activeThread},function(a,c,d){null!=a&&!0==a.success?vc.pm.notifications.add("info","%GETTEXT('pm.block.success')%","block/"+vc.pm.activeThread):void 0!=a.message?vc.pm.notifications.add("error",a.message):vc.pm.notifications.add("error","%GETTEXT('mailbox.remotecallfailed')% [#1012]")}).fail(function(a,c,d){vc.pm.notifications.add("%GETTEXT('mailbox.remotecallfailed')% [#1013/"+a.status+"/"+c+"/"+d+"]")})},deleteConversation:function(a){a.preventDefault();
if(confirm("%GETTEXT('pm.deleteConversation.confirm')%")){var b=$(a.target).parents(".actions").data("contact");$.post("%PATH%pm/deleteall/",{profileId:b},function(a,d,e){null!=a&&!0==a.success?(localStorage&&localStorage.removeItem("pm."+vc.pm.activeThread),$("#jThread"+b).remove(),$(".jPmMessages .jMessage").remove(),$(".jPmMessages .draft").remove()):void 0!=a.message?vc.pm.notifications.add("error",a.message):vc.pm.notifications.add("error","%GETTEXT('mailbox.remotecallfailed')% [#1004]")}).fail(function(a,
b,e){vc.pm.notifications.add("%GETTEXT('mailbox.remotecallfailed')% [#1005/"+a.status+"/"+b+"/"+e+"]")})}},toggleFilter:function(a){var b=$("#inboxControl .filterDialog");0<b.length&&(a.preventDefault(),b.is(":visible")?b.slideUp("slow"):b.slideDown("slow"))},markspam:function(a){a.preventDefault();var b=$("#jMessage"+$(a.target).data("pmId"));confirm("%GETTEXT('mailbox.markspam.confirm')%")&&(b.slideUp("slow"),mailids=[],mailids.push($(a.target).data("pmId")),$.post("%PATH%pm/flagspam/",{"mails[]":mailids},
function(a,d,e){null!=a&&!0==a.success||(void 0!=a.message?vc.pm.notifications.add("error",a.message):vc.pm.notifications.add("error","%GETTEXT('mailbox.remotecallfailed')% [#1006]"),b.show())}).fail(function(a,d,e){vc.pm.notifications.add("%GETTEXT('mailbox.remotecallfailed')% [#1007/"+a.status+"/"+d+"/"+e+"]");b.show()}),vc.pm.activeThread&&confirm("%GETTEXT('mailbox.markspam.block')%")&&$.post("%PATH%block/add/",{profileid:vc.pm.activeThread},function(a,d,e){null!=a&&!0==a.success||(void 0!=a.message?
vc.pm.notifications.add("error",a.message):vc.pm.notifications.add("error","%GETTEXT('mailbox.remotecallfailed')% [#1010]"),b.show())}).fail(function(a,d,e){vc.pm.notifications.add("%GETTEXT('mailbox.remotecallfailed')% [#1011/"+a.status+"/"+d+"/"+e+"]");b.show()}))},trashmail:function(a){a.preventDefault();var b=$("#jMessage"+$(a.target).data("pmId"));confirm("%GETTEXT('mailbox.trashmail.confirm')%")&&(b.slideUp("slow"),mailids=[],mailids.push($(a.target).data("pmId")),$.post("%PATH%pm/delete/",
{"mails[]":mailids},function(a,d,e){null!=a&&!0==a.success||(void 0!=a.message?vc.pm.notifications.add("error",a.message):vc.pm.notifications.add("error","%GETTEXT('mailbox.remotecallfailed')% [#1008]"),b.show())}).fail(function(a,d,e){vc.pm.notifications.add("error","%GETTEXT('mailbox.remotecallfailed')% [#1009/"+a.status+"/"+d+"/"+e+"]");b.show()}))},undo:function(a){a.preventDefault();$.post("%PATH%undo/"+$(this).data("action")+"/",{},function(a,c,d){null!=a&&!0==a.success?void 0!=a.message&&vc.pm.notifications.add("success",
a.message):void 0!=a.message?vc.pm.notifications.add("error",a.message):vc.pm.notifications.add("error","%GETTEXT('mailbox.remotecallfailed')% [#1017]")}).fail(function(a,c,d){vc.pm.notifications.add("%GETTEXT('mailbox.remotecallfailed')% [#1018/"+a.status+"/"+c+"/"+d+"]")})}},draft:{add:function(a){a.preventDefault();var b=$(".jReplyForm textarea"),c=$(".jReplyForm button"),d=b.val();""!==d&&(b.prop("disabled",!0),c.hide(),$(".jReplyForm .jLoading").show(),b.trigger("keyup"),$.post("%PATH%pm/draft/add/",
{contact:vc.pm.activeThread,message:d},function(a,c,g){!0==a.success?(b.val(""),$(".jPmMessages").append(Mustache.to_html($("#jPmDraftTemplate").html(),{id:a.pmDraftId,type:"store",text:d}))):vc.pm.notifications.add("error",a.message)}).fail(function(a,b,c){vc.pm.notifications.add("error","%GETTEXT('mailbox.remotecallfailed')% [#1014/"+a.status+"/"+b+"/"+c+"]")}).always(function(){b.prop("disabled",!1);$(".jReplyForm .jLoading").hide();c.show()}))},edit:function(a){a.preventDefault();a=$(a.target).closest(".draft");
"local"===a.data("type")?localStorage&&$(".jReplyForm textarea").val(localStorage.getItem("pm."+vc.pm.activeThread)):$(".jReplyForm textarea").val(vc.pm.drafts[a.data("id")])},remove:function(a){a.preventDefault();a=$(a.target).closest(".draft");a.remove();"local"===a.data("type")?localStorage&&localStorage.removeItem("pm."+vc.pm.activeThread):$.post("%PATH%pm/draft/delete/",{id:a.data("id")},function(a,c,d){null!=a&&!0==a.success||(void 0!=a.message?vc.pm.notifications.add("error",a.message):vc.pm.notifications.add("error",
"%GETTEXT('pm.draft.delete.error')% [#1015]"))}).fail(function(a,c,d){vc.pm.notifications.add("error","%GETTEXT('pm.draft.delete.error')% [#1016]")})}}};
vc.forum={contextType:"",contextId:"",page:0,updateTimestamp:0,init:function(a,b,c,d,e){vc.forum.contextType=a;vc.forum.contextId=b;vc.forum.page=c;vc.forum.checkUpdatesTimestamp=e;$(document).ready(function(){$(".jsForum").on("click",".jThread .threadArticle  .flag",{entityType:"%ENTITY_TYPE_FORUM_THREAD%"},vc.forum.actions.flag);$(".jsForum").on("click",".jThreadComment .flag",{entityType:"%ENTITY_TYPE_FORUM_COMMENT%"},vc.forum.actions.flag);$(".jsForum").on("click",".jComments .loadMoreComments a",
vc.forum.actions.loadMoreComments);d&&($("#newthread form").submit(vc.forum.addThread),$(".jThreads").on("submit",".newcomment form",vc.forum.addComment),$(".jsForum").on("click",".jThread .threadArticle .subscribe",vc.forum.actions.subscribeThread),$(".jsForum").on("click",".jThread .threadArticle .unsubscribe",vc.forum.actions.unsubscribeThread),$(".jsForum").on("click",".jThread .threadArticle .edit",vc.forum.actions.editThread),$(".jsForum").on("submit",".jThread .threadForm form",vc.forum.actions.saveThreadEdit),
$(".jsForum").on("click",".jThread .threadForm form .cancel",vc.forum.actions.cancelThreadEdit),$(".jsForum").on("click",".jThread .threadArticle .delete",vc.forum.actions.deleteThread),$(".jsForum").on("click",".jThread .threadArticle .hide",vc.forum.actions.hideThread),$(".jsForum").on("click",".jThread .threadArticle .unflag",vc.forum.actions.unflag),$(".jsForum").on("click",".jThread .threadArticle .jLike",{entityType:"%ENTITY_TYPE_FORUM_THREAD%",value:1},vc.forum.actions.like),$(".jsForum").on("click",
".jThread .threadArticle .jDislike",{entityType:"%ENTITY_TYPE_FORUM_THREAD%",value:-1},vc.forum.actions.like),$(".jsForum").on("click",".jThread .jAddComment",vc.forum.actions.addCommentForm),$(".jsForum").on("click",".jThreadComment .edit",vc.forum.actions.editThreadComment),$(".jsForum").on("submit",".jThreadComment form",vc.forum.actions.saveCommentEdit),$(".jsForum").on("click",".jThreadComment form .cancel",vc.forum.actions.cancelCommentEdit),$(".jsForum").on("click",".jThreadComment a.delete",
vc.forum.actions.deleteThreadComment),$(".jsForum").on("click",".jThreadComment a.unflag",vc.forum.actions.unflag),$(".jsForum").on("click",".jThreadComment .jLike",{entityType:"%ENTITY_TYPE_FORUM_COMMENT%",value:1},vc.forum.actions.like),$(".jsForum").on("click",".jThreadComment .jDislike",{entityType:"%ENTITY_TYPE_FORUM_COMMENT%",value:-1},vc.forum.actions.like),vc.websocket.attach(a,b,vc.forum.checkUpdates,1E4));if(""!=window.location.hash&&-1<window.location.hash.indexOf(".")){var c=window.location.hash.substr(1);
if(0==$('a[name="'+c+'"]').length){var c=c.split("."),e=$("#thread-"+c[0]);0<e.length&&vc.forum.actions.loadMoreCommentsByElement(c[0],$(".jComments",e),$(".loadMoreComments",e),c[1])}}})},addThread:function(a){a.preventDefault();var b=$("input[name=subject]",a.target),c=$("input[name=picture]",a.target),d=$("textarea[name=body]",a.target),e=$("input[name=context_type]",a.target).val(),f=$("input[name=context_id]",a.target).val(),g=b.val().trim(),m=c.val().trim(),h=d.val().trim();""===g&&""===m?alert("%GETTEXT('forum.thread.missing.subject')%"):
""===h&&""===m?alert("%GETTEXT('forum.thread.missing.body')%"):(""===m&&(m=null),""!==e&&""!==f&&(b.prop("disabled",!0),d.prop("disabled",!0),$(".loader",a.target).show(),$("button.save",a.target).hide(),$("button.picture",a.target).hide(),$.post("%PATH%forum/thread/add/",{contextType:e,contextId:f,subject:g,body:h,picture:m},function(e,f,g){null!=e&&!0==e.success?(b.val(""),c.val(""),d.val(""),d.trigger("keyup"),$(".ajaxUpload img",a.target).remove(),$(".ajaxUploadPreview",a.target).empty(),vc.forum.checkUpdates()):
void 0!=e.message&&""!=e.message?alert(e.message):alert("%GETTEXT('forum.thread.add.failed')%")}).fail(function(){alert("%GETTEXT('forum.thread.add.failed')%")}).always(function(){b.prop("disabled",!1);d.prop("disabled",!1);$("button.save",a.target).show();$("button.picture",a.target).show();$(".loader",a.target).hide()})))},addComment:function(a){a.preventDefault();var b=$("textarea[name=body]",a.target),c=$("input[name=thread]",a.target).val(),d=b.val().trim();$(".loader",a.target).show();$("button.save",
a.target).hide();""===d?alert("%GETTEXT('forum.comment.missing.body')%"):""!==c&&(b.prop("disabled",!0),$.post("%PATH%forum/comment/add/",{thread:c,body:d},function(a,c,d){null!=a&&!0==a.success?(b.val(""),b.trigger("keyup"),vc.forum.checkUpdates()):void 0!=a.message&&""!=a.message?alert(a.message):alert("%GETTEXT('forum.comment.add.failed')%")}).fail(function(){alert("%GETTEXT('forum.comment.add.failed')%")}).always(function(){b.prop("disabled",!1);$("button.save",a.target).show();$(".loader",a.target).hide()}))},
updateInProgress:!1,checkUpdates:function(){!1==vc.forum.updateInProgress&&null!==vc.forum.checkUpdatesTimestamp&&(vc.forum.updateInProgress=!0,$.get("%PATH%updates/",{contextType:vc.forum.contextType,contextId:vc.forum.contextId,entityTypes:["%ENTITY_TYPE_FORUM_THREAD%","%ENTITY_TYPE_FORUM_COMMENT%"],after:vc.forum.checkUpdatesTimestamp},function(a,b,c){a.threads&&(0==vc.forum.page&&$.each(a.threads.add,function(a,b){if(0===$("#thread-"+a+" .threadArticle").length){var c=$(".jThreads");c.prepend(b);
vc.timeago.update(c)}}),$.each(a.threads.edit,function(a,b){$("#thread-"+a+" .threadArticle").html(b);vc.timeago.update($("#thread-"+a+" .threadArticle"))}),$.each(a.threads.remove,function(a,b){$("#thread-"+b).remove()}),vc.ui.updateUI());a.comments&&($.each(a.comments.add,function(a,b){var c=$("#thread-"+a+" .jComments");c.append(b);vc.timeago.update(c)}),$.each(a.comments.edit,function(a,b){$("#thread-comment-"+a).replaceWith(b);vc.timeago.update($("#thread-comment-"+a))}),$.each(a.comments.remove,
function(a,b){$("#thread-comment-"+b).remove()}));a.lastUpdate&&(vc.forum.checkUpdatesTimestamp=a.lastUpdate)}).always(function(){vc.forum.updateInProgress=!1}))},actions:{subscribeThread:function(a){a.preventDefault();var b=$(a.target).data("entityId");$(a.target).parents(".jThread");$.post("%PATH%subscription/add/",{entityType:"%ENTITY_TYPE_FORUM_THREAD%",entityId:b},function(b,d,e){b.success?($(a.target).removeClass("subscribe"),$(a.target).addClass("unsubscribe"),$(a.target).text("%GETTEXT('forum.thread.unsubscribe')%")):
b.message?alert(b.message):alert("%GETTEXT('forum.thread.subscribe.failed')%")}).fail(function(){alert("%GETTEXT('forum.thread.subscribe.failed')%")})},unsubscribeThread:function(a){a.preventDefault();var b=$(a.target).data("entityId");$(a.target).parents(".jThread");$.post("%PATH%subscription/delete/",{entityType:"%ENTITY_TYPE_FORUM_THREAD%",entityId:b},function(b,d,e){b.success?($(a.target).removeClass("unsubscribe"),$(a.target).addClass("subscribe"),$(a.target).text("%GETTEXT('forum.thread.subscribe')%")):
b.message?alert(b.message):alert("%GETTEXT('forum.thread.unsubscribe.failed')%")}).fail(function(){alert("%GETTEXT('forum.thread.unsubscribe.failed')%")})},editThread:function(a){a.preventDefault();var b=$(a.target).data("entityId");$.get("%PATH%forum/thread/edit/",{id:b},function(a,d,e){d=$("#jForumThreadEditTemplate").html();a=Mustache.to_html(d,a);d=$("#thread-"+b+" .threadArticle");$("#thread-"+b+" .context").hide();d.hide();$(a).insertAfter(d);vc.ui.initAutoHeight($("#thread-"+b+" textarea"))}).fail(function(){alert("%GETTEXT('forum.thread.edit.failed')%")})},
saveThreadEdit:function(a){a.preventDefault();var b=$("input[name=id]",a.target).val(),c=$("input[name=subject]",a.target),d=$("textarea[name=body]",a.target).val().trim();if(1==c.length){if(c=c.val().trim(),""===c){alert("%GETTEXT('forum.thread.missing.subject')%");return}}else c=null;""===d?alert("%GETTEXT('forum.thread.missing.body')%"):""!==b&&($(".loader",a.target).show(),$("button.save",a.target).hide(),$.post("%PATH%forum/thread/edit/",{id:b,subject:c,body:d},function(a,c,d){null!=a&&!0==a.success?
(vc.forum.checkUpdates(),$("#thread-"+b+" .threadForm").remove(),$("#thread-"+b+" .threadArticle").show(),$("#thread-"+b+" .context").show()):void 0!=a.message?alert(a.message):alert("%GETTEXT('forum.thread.edit.failed')%")}).fail(function(){alert("%GETTEXT('forum.thread.edit.failed')%")}).always(function(){$("button.save",a.target).show();$(".loader",a.target).hide()}))},cancelThreadEdit:function(a){a.preventDefault();a=$(a.target).parents("form");a=$("input[name=id]",a).val();$("#thread-"+a+" .threadForm").remove();
$("#thread-"+a+" .threadArticle").show();$("#thread-"+a+" .context").show()},deleteThread:function(a){a.preventDefault();$.post("%PATH%forum/thread/delete/",{id:$(a.target).data("entityId")},function(a,c,d){null!=a&&!0==a.success?vc.forum.checkUpdates():void 0!=a.message?alert(a.message):alert("%GETTEXT('forum.thread.delete.failed')%")}).fail(function(){alert("%GETTEXT('forum.thread.delete.failed')%")})},hideThread:function(a){a.preventDefault();$.post("%PATH%mysite/hidefeed/",{id:$(a.target).data("entityId")},
function(b,c,d){null!=b&&!0==b.success?$("#thread-"+$(a.target).data("entityId")).remove():void 0!=b.message?alert(b.message):alert("%GETTEXT('forum.thread.hide.failed')%")}).fail(function(){alert("%GETTEXT('forum.thread.hide.failed')%")})},editThreadComment:function(a){a.preventDefault();var b=$(a.target).data("entityId"),c=$("#jForumCommentEditTemplate").html();$.get("%PATH%forum/comment/edit/",{id:b},function(a,e,f){void 0!=a.id&&void 0!=a.body?($("#thread-comment-"+b+" .context").hide(),a=Mustache.to_html(c,
a),e=$("#thread-comment-"+b+" .threadCommentArticle"),e.hide(),$(a).insertAfter(e),vc.ui.initAutoHeight($("#thread-comment-"+b+" textarea"))):alert("%GETTEXT('forum.thread.edit.failed')%")}).fail(function(){alert("%GETTEXT('forum.thread.edit.failed')%")})},saveCommentEdit:function(a){a.preventDefault();var b=$("input[name=id]",a.target).val(),c=$("textarea[name=body]",a.target).val().trim();""===c?alert("%GETTEXT('forum.comment.missing.body')%"):""!==b&&($(".loader",a.target).show(),$("button.save",
a.target).hide(),$.post("%PATH%forum/comment/edit/",{id:b,body:c},function(a,c,f){null!=a&&!0==a.success?(vc.forum.checkUpdates(),$("#thread-comment-"+b+" .threadCommentForm").remove(),$("#thread-comment-"+b+" .threadCommentArticle").show(),$("#thread-comment-"+b+" .context").show()):void 0!=a.message?alert(a.message):alert("%GETTEXT('forum.comment.edit.failed')%")}).fail(function(){alert("%GETTEXT('forum.comment.edit.failed')%")}).always(function(){$("button.save",a.target).show();$(".loader",a.target).hide()}))},
cancelCommentEdit:function(a){a.preventDefault();a=$(a.target).parents("form");a=$("input[name=id]",a).val();$("#thread-comment-"+a+" .threadCommentForm").remove();$("#thread-comment-"+a+" .threadCommentArticle").show();$("#thread-comment-"+a+" .context").show()},deleteThreadComment:function(a){a.preventDefault();$.post("%PATH%forum/comment/delete/",{id:$(a.target).data("entityId")},function(a,c,d){null!=a&&!0==a.success?vc.forum.checkUpdates():void 0!=a.message?alert(a.message):alert("%GETTEXT('forum.comment.delete.failed')%")}).fail(function(){alert("%GETTEXT('forum.comment.delete.failed')%")})},
flag:function(a){a.preventDefault();confirm("%GETTEXT('group.confirm.flag')%")&&$.post("%PATH%flag/add/",{entityType:a.data.entityType,entityId:$(a.target).data("entityId")},function(a,c,d){void 0!=a.message?alert(a.message):alert("%GETTEXT('flag.failed')%")}).fail(function(){alert("%GETTEXT('flag.failed')%")})},unflag:function(a){a.preventDefault();confirm("%GETTEXT('group.confirm.unflag')%")&&$.post("%PATH%flag/unflag/",{id:$(a.target).data("flagId")},function(b,c,d){!0==b.success?(b=$(a.target).parents(".jThreadComment"),
0<b.length?$(".flaggedThreadCommentArticle",b).removeClass("flaggedThreadCommentArticle"):(b=$(a.target).parents(".jThread"),$(".flaggedThreadArticle",b).removeClass("flaggedThreadArticle"))):alert("%GETTEXT('unflag.failed')%")}).fail(function(){alert("%GETTEXT('unflag.failed')%")})},like:function(a){a.preventDefault();var b=$(a.target).closest("a");$.post("%PATH%like/",{entityType:a.data.entityType,entityId:b.data("entityId"),value:a.data.value},function(a,d,e){!0==a.success?(d=b.closest("div"),
$("span.i",$("a.jLike",d).next()).text("("+a.likes+")"),$("span.i",$("a.jDislike",d).next()).text("("+a.dislikes+")")):alert("%GETTEXT('like.failed')%")}).fail(function(){alert("%GETTEXT('like.failed')%")})},addCommentForm:function(a){a.preventDefault();a=$(a.target).closest(".jThread");var b=$(".newcomment",a);$("section.comments > aside > nav",a).slideUp();b.slideDown();$("textarea",b).focus()},loadMoreComments:function(a){a.preventDefault();vc.forum.actions.loadMoreCommentsByElement($(a.target).data("threadId"),
$(a.target).closest(".jComments"),$(a.target).closest(".loadMoreComments"),null)},loadMoreCommentsByElement:function(a,b,c,d){var e=0;$(".jThreadComment .jAgo",b).each(function(a,b){var c=$(b).data("ts");if(e>c||0==e)e=c});$.get("%PATH%forum/comment/list/",{thread:a,before:e},function(e,g,m){e.comments?($.each(e.comments,function(a,b){$(b).insertAfter(c)}),vc.timeago.update(b),!1==e.moreAvailable?c.remove():null!==d&&0==$("#thread-comment-"+d).length&&vc.forum.actions.loadMoreCommentsByElement(a,
b,c,d),null!==d&&(e=$("#thread-comment-"+d),1==e.length&&$("html, body").animate({scrollTop:e.offset().top},2E3))):alert("%GETTEXT('forum.thread.loadMoreComments.failed')%")}).fail(function(){alert("%GETTEXT('forum.thread.loadMoreComments.failed')%")})}}};vc=vc||{};vc.groups=vc.groups||{};
vc.groups.header={init:function(){$(document).ready(function(){$("body").on("submit","form.jLeave",vc.groups.header.leaveGroupConfirm);$("body").on("submit","form.jCancel",vc.groups.header.cancelRequestConfirm);$("body").on("click",".jInvite",vc.groups.header.openInvitationDialog);$("body").on("click",".jDeleteGroup",vc.groups.header.deleteGroup);$("body").on("click",".deleteGroupDialog button.cancel",vc.groups.header.closeDeleteGroup);$("body").on("submit",".inviteMemberDialog form",vc.groups.header.inviteMembers)})},
leaveGroupConfirm:function(a){confirm("%GETTEXT('group.detail.leave.confirm')%")||a.preventDefault()},cancelRequestConfirm:function(a){confirm("%GETTEXT('group.detail.cancelRequest.confirm')%")||a.preventDefault()},openInvitationDialog:function(a){a.preventDefault();a=$(a.target).data("groupId");var b=$('<div data-group-id="'+a+'"></div>').load("%PATH%groups/invitation/add/"+a).dialog({dialogClass:"inviteMemberDialog",title:"%GETTEXT('group.invitation.title')%",width:Math.min(480,0.95*$(window).width()),
position:{at:"center top"},close:function(a,d){$(b).remove()}})},inviteMembers:function(a){a.preventDefault();var b=$("input[name='profileId[]']:checked",a.target);0==b.length&&alert("%GETTEXT('group.invitation.emptyProfileId')%");var c=[];b.each(function(a,b){c.push($(b).val())});$.post("%PATH%groups/invitation/add/",{groupId:$(a.target).parent(".ui-dialog-content").data("groupId"),profileId:c,comment:$("textarea",a.target).val()},function(b,c,f){null!=b&&!0==b.success?($(a.target).parent(".ui-dialog-content").dialog("close"),
alert("%GETTEXT('group.invitation.success')%")):alert("%GETTEXT('group.invitation.failed')%")}).fail(function(){alert("%GETTEXT('group.invitation.failed')%")})},deleteGroup:function(a){a.preventDefault();$("#deleteGroupDialog").dialog({dialogClass:"deleteGroupDialog",title:"%GETTEXT('group.detail.deletegroup')%",width:Math.min(480,0.95*$(window).width())})},closeDeleteGroup:function(a){a.preventDefault();$("#deleteGroupDialog").dialog("close")}};
vc.groups.info={init:function(){vc.groups.header.init();$(document).ready(function(){$("body").on("click",".jUnconfirmedMembers button",vc.groups.info.actions.handleUnconfirmed);$(".jMembers").on("click",".remove",vc.groups.info.actions.remove);$(".jMembers").on("click",".ban",vc.groups.info.actions.ban);$(".jMembers").on("click",".modAdd",{role:1,confirm:"%GETTEXT('group.confirm.role.add.mod')%"},vc.groups.info.actions.role.add);$(".jMembers").on("click",".modRemove",{role:1,confirm:"%GETTEXT('group.confirm.role.remove.mod')%"},
vc.groups.info.actions.role.remove);$(".jMembers").on("click",".adminAdd",{role:2,confirm:"%GETTEXT('group.confirm.role.add.admin')%"},vc.groups.info.actions.role.add);$(".jMembers").on("click",".adminRemove",{role:2,confirm:"%GETTEXT('group.confirm.role.remove.admin')%"},vc.groups.info.actions.role.remove)})},actions:{handleUnconfirmed:function(a){a.preventDefault();a=$(a.target);0==a.data("action").length||0==a.data("groupId").length||0==a.data("userId").length?alert("%GETTEXT('group.members.unconfirmed.failed')%"):
$.post("%PATH%groups/members/handle/",{action:a.data("action"),groupId:a.data("groupId"),profileId:a.data("userId")},function(a,c,d){null!=a&&!0==a.success?$("#unconfirmed-member-"+a.user).remove():void 0!=a.message?alert(a.message):alert("%GETTEXT('group.members.unconfirmed.failed')%")}).fail(function(){alert("%GETTEXT('group.members.unconfirmed.failed')%")})},remove:function(a){a.preventDefault();var b=$(a.target);0==b.data("groupId").length||0==b.data("userId").length?alert("%GETTEXT('group.members.action.failed')%"):
confirm("%GETTEXT('group.confirm.removeMember')%")&&$.post("%PATH%groups/members/remove/",{groupId:b.data("groupId"),profileId:b.data("userId"),ban:0},function(a,d,e){null!=a&&!0==a.success?$("#groupMemberProfilebox"+b.data("userId")).remove():void 0!=a.message?alert(a.message):alert("%GETTEXT('group.members.action.failed')%")}).fail(function(){alert("%GETTEXT('group.members.action.failed')%")})},ban:function(a){a.preventDefault();var b=$(a.target);0==b.data("groupId").length||0==b.data("userId").length?
alert("%GETTEXT('group.members.action.failed')%"):confirm("%GETTEXT('group.confirm.banMember')%")&&$.post("%PATH%groups/members/remove/",{groupId:b.data("groupId"),profileId:b.data("userId"),ban:1},function(a,d,e){null!=a&&!0==a.success?$("#groupMemberProfilebox"+b.data("userId")).remove():void 0!=a.message?alert(a.message):alert("%GETTEXT('group.members.action.failed')%")}).fail(function(){alert("%GETTEXT('group.members.action.failed')%")})},role:{add:function(a){a.preventDefault();var b=$(a.target);
0==b.data("groupId").length||0==b.data("userId").length?alert("%GETTEXT('group.members.action.failed')%"):confirm(a.data.confirm)&&$.post("%PATH%groups/members/role/",{groupId:b.data("groupId"),profileId:b.data("userId"),role:a.data.role,action:"add"},function(a,d,e){null!=a&&!0==a.success?$("#groupMemberProfilebox"+b.data("userId")).replaceWith(a.profilebox):void 0!=a.message?alert(a.message):alert("%GETTEXT('group.members.action.failed')%")}).fail(function(){alert("%GETTEXT('group.members.action.failed')%")})},
remove:function(a){a.preventDefault();var b=$(a.target);0==b.data("groupId").length||0==b.data("userId").length?alert("%GETTEXT('group.members.action.failed')%"):confirm(a.data.confirm)&&$.post("%PATH%groups/members/role/",{groupId:b.data("groupId"),profileId:b.data("userId"),role:a.data.role,action:"remove"},function(a,d,e){null!=a&&!0==a.success?$("#groupMemberProfilebox"+b.data("userId")).replaceWith(a.profilebox):void 0!=a.message?alert(a.message):alert("%GETTEXT('group.members.action.failed')%")}).fail(function(){alert("%GETTEXT('group.members.action.failed')%")})}}}};
vc.groups.forum={init:function(a,b,c,d){vc.groups.header.init();vc.forum.init("%ENTITY_TYPE_GROUP_FORUM%",a,b,c,d);c&&($("body").on("click","a.subscribeForum",vc.groups.forum.actions.subscribeForum),$("body").on("click","a.unsubscribeForum",vc.groups.forum.actions.unsubscribeForum))},actions:{subscribeForum:function(a){a.preventDefault();var b=$(a.target).data("forumId");$.post("%PATH%subscription/add/",{entityType:"%ENTITY_TYPE_GROUP_FORUM%",entityId:b},function(a,d,e){a.success?($("a.subscribeForum[data-forum-id="+
b+"]").hide(),$("a.unsubscribeForum[data-forum-id="+b+"]").show()):a.message?alert(a.message):alert("%GETTEXT('group.forum.subscribe.failed')%")}).fail(function(){alert("%GETTEXT('group.forum.subscribe.failed')%")})},unsubscribeForum:function(a){a.preventDefault();var b=$(a.target).data("forumId");$(a.target).parents(".jThread");$.post("%PATH%subscription/delete/",{entityType:"%ENTITY_TYPE_GROUP_FORUM%",entityId:b},function(a,d,e){a.success?($("a.unsubscribeForum[data-forum-id="+b+"]").hide(),$("a.subscribeForum[data-forum-id="+
b+"]").show()):a.message?alert(a.message):alert("%GETTEXT('group.forum.unsubscribe.failed')%")}).fail(function(){alert("%GETTEXT('group.forum.unsubscribe.failed')%")})}}};vc.groups.settings={init:function(){vc.groups.header.init()}};vc=vc||{};
vc.events={init:function(){$(document).ready(function(){$("body").on("click",".jInvite",vc.events.openInvitationDialog);$("body").on("click",".jParticipation",vc.events.participateButton);$("body").on("click",".ctabar a",vc.events.participateCta);$("body").on("submit",".inviteMemberDialog form",vc.events.inviteMembers)})},openInvitationDialog:function(a){a.preventDefault();a=$(a.target).closest("a").data("eventId");var b=$('<div data-event-id="'+a+'"></div>').load("%PATH%events/invitation/add/"+a).dialog({dialogClass:"inviteMemberDialog",
title:"%GETTEXT('event.invitation.title')%",width:Math.min(480,0.95*$(window).width()),position:{at:"center top"},close:function(a,d){$(b).remove()}})},participateButton:function(a){a.preventDefault();a=$(a.target).closest("a");vc.events.participate(a.data("id"),a.data("degree"))},participateCta:function(a){a.preventDefault();a=$(a.target).closest(".ctabar");vc.events.participate(a.data("id"),$('select[name="degree"]',a).val())},participate:function(a,b){$.post("%PATH%events/participate/",{id:a,degree:b},
function(a,d,e){null!=a&&!0==a.success?(a=$('a[data-degree="'+b+'"]'),$(".show-participate").removeClass("marked"),$(".jParticipation").removeClass("marked"),a.addClass("marked"),$(".show-participate",a.closest(".context")).addClass("marked"),$(".jParticipation").addClass("secondary"),a.removeClass("secondary"),$(".ctabar select").val(b)):alert("%GETTEXT('event.participate.failed')%")}).fail(function(){alert("%GETTEXT('event.participate.failed')%")})},inviteMembers:function(a){a.preventDefault();
var b=$("input[name='profileId[]']:checked",a.target);0==b.length&&alert("%GETTEXT('event.invitation.emptyProfileId')%");var c=[];b.each(function(a,b){c.push($(b).val())});$.post("%PATH%events/invitation/add/",{eventId:$(a.target).parent(".ui-dialog-content").data("eventId"),profileId:c},function(b,c,f){null!=b&&!0==b.success?($(a.target).parent(".ui-dialog-content").dialog("close"),alert("%GETTEXT('group.invitation.success')%")):alert("%GETTEXT('event.invitation.failed')%")}).fail(function(){alert("%GETTEXT('event.invitation.failed')%")})}};
vc=vc||{};
vc.timeago={strings:{seconds:"%GETTEXT('timeago.seconds')%",minute:"%GETTEXT('timeago.minute')%",minutes:"%GETTEXT('timeago.minutes')%",hour:"%GETTEXT('timeago.hour')%",hours:"%GETTEXT('timeago.hours')%",day:"%GETTEXT('timeago.day')%",days:"%GETTEXT('timeago.days')%",date:"%GETTEXT('timeago.date')%"},init:function(){window.setInterval(function(){vc.timeago.update()},15E3);vc.timeago.update(null)},update:function(a){$("span.jAgo",a).each(function(a,c){var d=$(c);now=(new Date).getTime();difference=
now-1E3*$(d).data("ts");var e="%GETTEXT('timeago.full')%",f=new Date;f.setTime(1E3*$(d).data("ts"));var g=f.getMonth()+1;10>g&&(g="0"+g);var m=f.getDate();10>m&&(m="0"+m);var h=f.getHours();10>h&&(h="0"+h);var n=f.getMinutes();10>n&&(n="0"+n);var s=f.getSeconds();10>s&&(s="0"+s);e=e.replace(/Y/,f.getFullYear()).replace(/m/,g).replace(/d/,m).replace(/H/,h).replace(/i/,n).replace(/s/,s);d.attr("title",e);6048E5<difference?text=vc.timeago.strings.date.replace(/Y/,f.getFullYear()).replace(/m/,g).replace(/d/,
m).replace(/H/,h).replace(/i/,n).replace(/s/,s):1728E5<difference?(text=vc.timeago.strings.days,text=text.replace(/%d/,Math.round(difference/864E5))):864E5<difference?text=vc.timeago.strings.day:72E5<difference?(text=vc.timeago.strings.hours,text=text.replace(/%d/,Math.round(difference/36E5))):33E5<difference?text=vc.timeago.strings.hour:9E4<difference?(text=vc.timeago.strings.minutes,text=text.replace(/%d/,Math.round(difference/6E4))):text=5E4<difference?vc.timeago.strings.minute:vc.timeago.strings.seconds;
d.text(text)})}};$(document).ready(function(){vc.timeago.init()});
vc.fb={init:function(){$(document).ready(function(){try{FB.init({appId:"%FACEBOOK_APP%",status:!0,cookie:!0,xfbml:!0})}catch(a){$(".jLoginLoading").hide(),$(".jLoadFail").show()}})},login:function(){$(document).ready(function(){FB.getLoginStatus(function(a){"connected"==a.status?vc.fb.connect(a.authResponse):FB.login(function(a){"connected"==a.status?vc.fb.connect(a.authResponse):($(".jLoginLoading").hide(),$(".jLoginFailed").show(),window.history.back())})},{scope:"public_profile,email,user_birthday"})})},
connect:function(a){$.post("%PATH%fb/tokenlogin/",{accessToken:a.accessToken},function(b,c,d){b.success?window.document.location="%PATH%mysite/":($('form#jsFbSignup input[name="fb_user_id"]').val(a.userID),$('form#jsFbSignup input[name="fb_access_token"]').val(a.accessToken),$("form#jsFbSignup").submit())})}};
